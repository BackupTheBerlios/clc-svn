<html>
  <head>
    <link rel="stylesheet" type="text/css" href="../sparc/sparc.css" />


</head>
  <body>
    <h1>xsvn-howto / maintaining ports for CRUX/SPARC</h1>

    <div class="sectitle">Preparation</div>
    <div class="section">

<pre>$ export SVN_SSH="ssh -l &lt;username&gt;"
$ mkdir -p ~/crux/sparc  # location doesn't matter, really
$ cd ~/crux/sparc
$ wget http://jw.tks6.net/files/crux/xsvn/xsvn
$ mv xsvn &lt;somewhere in your path&gt;</pre>

	<p>
Also read <a href="https://developer.berlios.de/docman/display_doc.php?docid=394&group_id=2">the svn howto at berlios</a>
	</p>

	<p>
<b>NOTE</b>: we might eventually run into permission problems since I
currently don't set my umask to 002
	</p>
    </div>


    <div class="sectitle">Setup</div>
    <div class="section">

<h4>Initial checkout</h4>

<pre>$ svn co svn+ssh://svn.berlios.de/svnroot/repos/clc/sparc/trunk/contrib
$ cd contrib</pre>


<h4>Prepare xsvn</h4>

<pre>$ echo "export XSVN_RELEASE=CRUX-2_1"   >  .xsvn-config
$ echo "export XSVN_BASE_URL=svn+ssh://svn.berlios.de/svnroot/repos/clc" >> .xsvn-config
$ echo "export XSVN_COLLECTION=contrib" >> .xsvn-config
$ echo "export XSVN_ARCH=sparc"         >> .xsvn-config</pre>

xsvn uses those variables to understand where to merge from, and where
to release to. This file is simply sourced, so you can put other stuff
there too (like the SVN_SSH setting).
</div>
      
    <div class="sectitle">Working on the ports</div>
    <div class="section">


<h4>Merge a port from another architecture</h4>

<pre>$ xsvn merge-from x86/tags/CRUX-2_1/contrib someport</pre>

This will fetch the port and add it you your working copy. After that,
build, test and fix if needed, then commit:

<pre>$ svn ci someport -m "import someport to sparc/contrib"</pre>
The above assume you're in the base directory of your working copy;
if you cd'ed into the directory before to build it, you can also do:
<pre>$ svn ci -m import someport to sparc/contrib"</pre>

You can check the current status (files modified, files to be added
etc) like this:
<Pre>$ svn status</pre>




Repeated merges should work just the same; to get the changes in from
x86 since the last merge, just do a 'merge-from' like shown above.


<h4>Release a port for a specific crux release</h4>

In order to run this, you must be in the base directory of your
working copy (~crux/sparc/contrib for the example above)

<pre>$ xsvn release someport</pre>

xsvn will read your .xsvn-config, and combine base url, release,
collection and architecture to the correct URL. It'll also release it
immediately


<h4>Adding a new port (not merging from another arch)</h4>

<pre>$ svn add -N myport
$ cd myport
$ svn add Pkgfile .md5sum .footprint
$ svn ci -m "add myport to sparc"</pre>


    </div>
    <div class="sectitle">Additional notes</div>
    <div class="section">

Missing features:
      <ul>
	<li>checking for ports missing in a certain collection compared to another arch</li>
<li>dropping a port from a collection easily</li>
<li>diff'ing against other archs</li>
      </div>

    
    <div class="sectitle">The concept of xsvn</div>
    <div class="section">
      xsvn stores merge points as subversion properties. This way, it
      is possible to calculate the chances since the last merge
      operation. Obviously, this does not consider the fact that we
      could be merging from a different branch.
    </div>

    </body>
</html>